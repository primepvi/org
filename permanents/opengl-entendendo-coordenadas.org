#+title: OpenGL - Entendendo Coordenadas
#+created_at: [2025-11-10]
#+edited_at: [2025-14-10]
#+tags: golang c data-structures

** Introdução

O OpenGL espera que todos os vértices que serão visíveis estejam em coordenadas normalizadas do dispositivo (NDC) após cada execução do vertex shader. Portanto, as coordenadas (x, y, z) devem estar entre -1.0 e 1.0, sendo assim os vértices fora desse intervalo de coordenada não serão visíveis.

A metodologia que utilizamos para especificar as coordenadas de objetos com maior flexibilidade é utilizarmos um espaço pré-determinado e no vertex shader transformar essas coordenadas em coordenadas normalizadas do dispositivo (NDC), afim de serem transformadas em pixels na tela.

** Transformação de Coordenadas

Existe um pipeline para a transformação de coordenadas em NDC, onde transformamos os vértices de um objeto em vários sistemas de coordenada antes de finalmente transformar em NDC, a presença de diversos sistemas nos dá mais flexibilidade, visto que algumas operações são mais fáceis em certos sistemas de coordenadas. Geralmente temos um total de 5 sistemas de coordenadas, veja elas abaixo:

- Local Space
- World Space
- View Space
- Clip Space
- Screen Space

** Local Space

O local space é o espaço de coordenadas relativo ao objeto propriamente dito, se temos um triângulo na coordenada (0, 0, 0) do world space seus vértices tem coordenadas relativas ao espaço do objeto e não ao espaço mundial (world space).

** World Space

O world space é o espaço de coordenadas onde a posição dos objetos são representadas, portanto os objetos são posicionados a partir de sua origem (0, 0, 0). Portanto, todos os vértices no local space posteriormente devem ser transformados em coordenadas relativas ao world space, essa transformação é feita utilizando a matriz de modelo (model matrix).

A matriz modelo é uma matriz de transformação que traduz, dimensiona e/ou rotaciona um objeto para posicioná-lo corretamente no world space.

** View Space

O view space é geralmente chamado de câmera do OpenGL.

[[file:../assets/local-to-word-matrix.png]]

O espaço de visualização ou view space, é o espaço resultante da transformação das coordenadas do world space para a vista do visualizador. Portanto, o view space é o espaço de vista da câmera, essa transformação geralmente é feita com translações e/ou rotações no mundo para que os objetos fiquem para a frente da câmera. Essas transformações são acopladas numa matriz de transformação chamada de matriz de visualização (view matrix).

** Clip Space

No final da execução do vertex shader o OpenGL espera que as coordenadas estejam no espaço NDC, sendo que qualquer coordenada fora dos limites é cortada. Especificar todas coordenadas visíveis no intervalo NDC não é muito intuitivo, portanto utilizamos uma matriz de projeção que especifica um intervalo de coordenadas (ex: -1000 a 1000) e então mapeamos para coordenadas NDC, afim de transformar as coordenadas no view space para o clip space. Sendo que tudo que tiver fora desse intervalo será cortado.

A matriz de projeção utilizada para transformar coordenadas de exibição em coordenadas de clipe geralmente é Ortográfica para 2D e Perspectiva para 3D.

** Projeção Ortográfica

Uma matriz de projeção ortográfica (geralmente utilizada para projeção 2D), possui uma caixa de frustum em forma de cubo que define o clip space onde cada vértice fora dessa caixa é recortado. Para criarmos uma matriz de projeção ortográfica, precisamos especificar a largura, altura e comprimento do frustum. Todas as coordenadas dentro dele serão transformadas para NDC. Segue um exemplo abaixo:

[[file:../assets/orthographic-projection.png]]

** Juntando Tudo

Criamos uma matriz de transformação para cada uma das etapas citadas: modelo, visualização, projeção. Uma coordenada de vértice é transformada para coordenadas de clipe da seguinte maneira:

V_\text{clip} = M_\text{projection} \cdot M_\text{view} \cdot M_\text{model} \cdot V_\text{local}

Note que a ordem de multiplicação para matriz é invertida, portanto deve ser leita da direita pra esquerda. O vértice resultante é atribuído a `gl_Position` no vertex shader e o OpenGL executará automaticamente a divisão de perspectiva e o recorte.
